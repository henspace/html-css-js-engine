/* Copyright 2025 Steve Butler (henspace.com)
 * License: MIT
 */
let variantId = '';let storageKeyPrefix;function getKeyPrefix() {if (!storageKeyPrefix) {throw new Error('The storageKeyPrefix has not been set. Check module hcje/storage, setStorageKeyPrefix()');}return `${storageKeyPrefix}_${variantId}`;}function getFullKey(itemKey) {return `${getKeyPrefix()}_${itemKey}`;}export function setStorageKeyPrefix(prefix) {storageKeyPrefix = prefix.replace(/\W+/g, '_');console.debug(`Storage key prefix set to "${storageKeyPrefix}"`);}export function setVariantId(id = '') {variantId = id.replace(/\W+/g, '_');console.debug(`Storage variant id set to ${variantId}`);}export function setItem(key, value) {return localStorage.setItem(getFullKey(key), JSON.stringify(value));}export function getItem(key) {const safeKey = getFullKey(key);try {const json = localStorage.getItem(safeKey);if (json) {return JSON.parse(json);}} catch (error) {localStorage.removeItem(safeKey);console.error(`Failed to parse ${safeKey} so item removed: ${error.message}`);}return undefined;}export function removeItem(key) {return localStorage.removeItem(getFullKey(key));}export function clear() {const keyPrefix = getKeyPrefix();const appKeys = [];for (let index = 0; index < localStorage.length; index++) {const key = localStorage.key(index);if (key.startsWith(keyPrefix)) {appKeys.push(key);}}for (const key of appKeys) {localStorage.removeItem(key);console.debug(`Removed ${key} from localStorage.`);}}