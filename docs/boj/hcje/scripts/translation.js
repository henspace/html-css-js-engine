/* Copyright 2025 Steve Butler (henspace.com)
 * License: MIT
 */
import * as utils from './utils.js'let translationPrefix = '';let translationSuffix = '';let missingPrefix = '';let missingSuffix = '';if (new URLSearchParams(document.location.search).get('flag-translation') !== null) {translationPrefix = '[tx=';translationSuffix = ']';missingPrefix = '[tx? ';missingSuffix = ']';}let translations = {};function addLanguageCodeToUrl(baseUrl, languageCode) {return baseUrl.replace(/\.(json|txt|md)$/i,`-${languageCode}.$1`)}export function getPreferredLanguage() {return navigator.language.replace(/-\w*$/, '');}export function loadData(config) {let languageCode = config.languageCode || getPreferredLanguage();const fallbackLanguageCode = config.fallbackLanguageCode || 'en';if (config.filter && !config.filter.includes(languageCode)) {console.info(`Language filter does not include ${languageCode} so using fallback of ${fallbackLanguageCode}.`);languageCode = fallbackLanguageCode;}let url = addLanguageCodeToUrl(config.baseUrl, languageCode);return utils.fetchTextOrJson(url, config.asJson, null).then((result) => {if (result) {console.info(`Loaded data in language ${languageCode} from ${url}`);return result;} else if (fallbackLanguageCode !== languageCode) {console.error(`Failed to load data in language ${languageCode} from ${url}; trying fallback ${fallbackLanguageCode}.`);url = addLanguageCodeToUrl(config.baseUrl, fallbackLanguageCode);return utils.fetchJson(url, config.asJon, null);} else {console.error(`Failed to load data in language ${languageCode} from ${url} and no fallback.`);return result;}});}export function loadTranslation(config) {console.info(`Loading translations`);translations = {};return loadData({baseUrl: config.baseUrl,languageCode: config.languageCode,fallbackLanguageCode: config.fallbackLanguageCode,filter: config.filter,asJson: true}).then((result) => {if (result) {translations = result;return true;} else {return false;}});}export function translate(key) {if (key === '') {return key;}let result = translations[key];if (result !== null && result !== undefined) {if (result === '') {result = key;}return `${translationPrefix}${result}${translationSuffix}`;} else {return `${missingPrefix}${key}${missingSuffix}`;}}export function i18n(strs, ...expressions) {let expIndex = 0;const result = [];for (const str of strs) {result.push(translate(str));if (expIndex < expressions.length) {result.push(`${expressions[expIndex++]}`);}}return result.join('');}